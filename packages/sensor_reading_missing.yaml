#Sensorer:
#Regnmätare
# Badrum
#Ute2
#Louise rum
# Frys
# Kyl
# Tvättstuga
# Värmepump
# Förråd
# Garage
# Vardagsrum
# Friggebod
#Inne grannen
# Hall
#På vinden
#Ute
#Uterum
#Sovrum
#Uteluft
#Avluft
#Tilluft
#Franluft
#Ljusstyrka

#########################################################
sensor:
  - platform: template
    sensors:
      frys_temp_lastupdated:
        friendly_name: Frys temp senast uppdaterad
        value_template: >-
          {% if state_attr('sensor.frys_temperature', 'last_updated') == None %} 
            0 
          {% else %} 
            {{ states.sensor.frys_temperature.last_updated.strftime('%Y-%m-%dT%H:%M:%S') }} 
          {% endif %}
        device_class: timestamp
        icon_template: >-
          {% if state_attr('sensor.frys_temperature', 'last_updated') == None %} 
            mdi:progress-check
          {% elif (as_timestamp(now()) - as_timestamp(states.sensor.frys_temperature.last_updated) > 100) %}
            mdi:progress-alert
          {% else %}
            mdi:progress-check
          {% endif %}

      kyl_temp_lastupdated:
        friendly_name: Kyl temp senast uppdaterad
        value_template: >-
          {% if state_attr('sensor.kyl_temperature', 'last_updated') == None %} 
            0 
          {% else %} 
            {{ states.sensor.kyl_temperature.last_updated.strftime('%Y-%m-%dT%H:%M:%S') }} 
          {% endif %}
        device_class: timestamp
        icon_template: >-
          {% if state_attr('sensor.kyl_temperature', 'last_updated') == None %} 
            mdi:progress-check
          {% elif (as_timestamp(now()) - as_timestamp(states.sensor.kyl_temperature.last_updated) > 100) %}
            mdi:progress-alert
          {% else %}
            mdi:progress-check
          {% endif %}

      badrum_temp_lastupdated:
        friendly_name: Badrum temp senast uppdaterad
        value_template: >-
          {% if state_attr('sensor.lumi_lumi_weather_temperature', 'last_updated') == None %} 
            0 
          {% else %} 
            {{ states.sensor.lumi_lumi_weather_temperature.last_updated.strftime('%Y-%m-%dT%H:%M:%S') }} 
          {% endif %}
        device_class: timestamp
        icon_template: >-
          {% if state_attr('sensor.lumi_lumi_weather_temperature', 'last_updated') == None %} 
            mdi:progress-check
          {% elif (as_timestamp(now()) - as_timestamp(states.sensor.lumi_lumi_weather_temperature.last_updated) > 100) %}
            mdi:progress-alert
          {% else %}
            mdi:progress-check
          {% endif %}

      badrum_fukt_lastupdated:
        friendly_name: Badrum fukt senast uppdaterad
        value_template: >-
          {% if state_attr('sensor.lumi_lumi_weather_humidity', 'last_updated') == None %} 
            0 
          {% else %} 
            {{ states.sensor.lumi_lumi_weather_humidity.last_updated.strftime('%Y-%m-%dT%H:%M:%S') }} 
          {% endif %}
        device_class: timestamp
        icon_template: >-
          {% if state_attr('sensor.lumi_lumi_weather_humidity', 'last_updated') == None %} 
            mdi:progress-check
          {% elif (as_timestamp(now()) - as_timestamp(states.sensor.lumi_lumi_weather_humidity.last_updated) > 100) %}
            mdi:progress-alert
          {% else %}
            mdi:progress-check
          {% endif %}

      tvattstuga_temp_lastupdated:
        friendly_name: Tvättstuga temp senast uppdaterad
        value_template: >-
          {% if state_attr('sensor.tvattstuga_temperature', 'last_updated') == None %} 
            0 
          {% else %} 
            {{ states.sensor.tvattstuga_temperature.last_updated.strftime('%Y-%m-%dT%H:%M:%S') }} 
          {% endif %}
        device_class: timestamp
        icon_template: >-
          {% if state_attr('sensor.tvattstuga_temperature', 'last_updated') == None %} 
            mdi:progress-check
          {% elif (as_timestamp(now()) - as_timestamp(states.sensor.tvattstuga_temperature.last_updated) > 100) %}
            mdi:progress-alert
          {% else %}
            mdi:progress-check
          {% endif %}

      tvattstuga_fukt_lastupdated:
        friendly_name: Tvättstuga fukt senast uppdaterad
        value_template: >-
          {% if state_attr('sensor.tvattstuga_humidity', 'last_updated') == None %} 
            0 
          {% else %} 
            {{ states.sensor.tvattstuga_humidity.last_updated.strftime('%Y-%m-%dT%H:%M:%S') }} 
          {% endif %}
        device_class: timestamp
        icon_template: >-
          {% if state_attr('sensor.tvattstuga_humidity', 'last_updated') == None %} 
            mdi:progress-check
          {% elif (as_timestamp(now()) - as_timestamp(states.sensor.tvattstuga_humidity.last_updated) > 100) %}
            mdi:progress-alert
          {% else %}
            mdi:progress-check
          {% endif %}

      varmepump_temp_lastupdated:
        friendly_name: Värmepump temp senast uppdaterad
        value_template: >-
          {% if state_attr('sensor.varmepump_temperature', 'last_updated') == None %} 
            0 
          {% else %} 
            {{ states.sensor.varmepump_temperature.last_updated.strftime('%Y-%m-%dT%H:%M:%S') }} 
          {% endif %}
        device_class: timestamp
        icon_template: >-
          {% if state_attr('sensor.varmepump_temperature', 'last_updated') == None %} 
            mdi:progress-check
          {% elif (as_timestamp(now()) - as_timestamp(states.sensor.varmepump_temperature.last_updated) > 100) %}
            mdi:progress-alert
          {% else %}
            mdi:progress-check
          {% endif %}

      vardagsrum_temp_lastupdated:
        friendly_name: Vardagsum temp senast uppdaterad
        value_template: >-
          {% if state_attr('sensor.lumi_lumi_weather_temperature', 'last_updated') == None %} 
            0 
          {% else %} 
            {{ states.sensor.lumi_lumi_weather_temperature.last_updated.strftime('%Y-%m-%dT%H:%M:%S') }} 
          {% endif %}
        device_class: timestamp
        icon_template: >-
          {% if state_attr('sensor.lumi_lumi_weather_temperature', 'last_updated') == None %} 
            mdi:progress-check
          {% elif (as_timestamp(now()) - as_timestamp(states.sensor.lumi_lumi_weather_temperature.last_updated) > 100) %}
            mdi:progress-alert
          {% else %}
            mdi:progress-check
          {% endif %}

      hall_temp_lastupdated:
        friendly_name: Hall temp senast uppdaterad
        value_template: >-
          {% if state_attr('sensor.lumi_lumi_weather_temperature_2', 'last_updated') == None %} 
            0 
          {% else %} 
            {{ states.sensor.lumi_lumi_weather_temperature_2.last_updated.strftime('%Y-%m-%dT%H:%M:%S') }} 
          {% endif %}
        device_class: timestamp
        icon_template: >-
          {% if state_attr('sensor.lumi_lumi_weather_temperature_2', 'last_updated') == None %} 
            mdi:progress-check
          {% elif (as_timestamp(now()) - as_timestamp(states.sensor.lumi_lumi_weather_temperature_2.last_updated) > 100) %}
            mdi:progress-alert
          {% else %}
            mdi:progress-check
          {% endif %}

      hall_fukt_lastupdated:
        friendly_name: Hall fukt senast uppdaterad
        value_template: >-
          {% if state_attr('sensor.lumi_lumi_weather_humidity_2', 'last_updated') == None %} 
            0 
          {% else %} 
            {{ states.sensor.lumi_lumi_weather_humidity_2.last_updated.strftime('%Y-%m-%dT%H:%M:%S') }} 
          {% endif %}
        device_class: timestamp
        icon_template: >-
          {% if state_attr('sensor.lumi_lumi_weather_humidity_2', 'last_updated') == None %} 
            mdi:progress-check
          {% elif (as_timestamp(now()) - as_timestamp(states.sensor.lumi_lumi_weather_humidity_2.last_updated) > 100) %}
            mdi:progress-alert
          {% else %}
            mdi:progress-check
          {% endif %}

      garage_temp_lastupdated:
        friendly_name: Garage temp senast uppdaterad
        value_template: >-
          {% if state_attr('sensor.garage_temperature', 'last_updated') == None %} 
            0 
          {% else %} 
            {{ states.sensor.garage_temperature.last_updated.strftime('%Y-%m-%dT%H:%M:%S') }} 
          {% endif %}
        device_class: timestamp
        icon_template: >-
          {% if state_attr('sensor.garage_temperature', 'last_updated') == None %} 
            mdi:progress-check
          {% elif (as_timestamp(now()) - as_timestamp(states.sensor.garage_temperature.last_updated) > 100) %}
            mdi:progress-alert
          {% else %}
            mdi:progress-check
          {% endif %}

      garage_fukt_lastupdated:
        friendly_name: Garage fukt senast uppdaterad
        value_template: >-
          {% if state_attr('sensor.garage_humidity', 'last_updated') == None %} 
            0 
          {% else %} 
            {{ states.sensor.garage_humidity.last_updated.strftime('%Y-%m-%dT%H:%M:%S') }} 
          {% endif %}
        device_class: timestamp
        icon_template: >-
          {% if state_attr('sensor.garage_humidity', 'last_updated') == None %} 
            mdi:progress-check
          {% elif (as_timestamp(now()) - as_timestamp(states.sensor.garage_humidity.last_updated) > 100) %}
            mdi:progress-alert
          {% else %}
            mdi:progress-check
          {% endif %}

      forrad_temp_lastupdated:
        friendly_name: Förråd temp senast uppdaterad
        value_template: >-
          {% if state_attr('sensor.forrad_temperature', 'last_updated') == None %} 
            0 
          {% else %} 
            {{ states.sensor.forrad_temperature.last_updated.strftime('%Y-%m-%dT%H:%M:%S') }} 
          {% endif %}
        device_class: timestamp
        icon_template: >-
          {% if state_attr('sensor.forrad_temperature', 'last_updated') == None %} 
            mdi:progress-check
          {% elif (as_timestamp(now()) - as_timestamp(states.sensor.forrad_temperature.last_updated) > 100) %}
            mdi:progress-alert
          {% else %}
            mdi:progress-check
          {% endif %}

      friggebod_temp_lastupdated:
        friendly_name: Friggebod temp senast uppdaterad
        value_template: >-
          {% if state_attr('sensor.friggebod_temperature', 'last_updated') == None %} 
            0 
          {% else %} 
            {{ states.sensor.friggebod_temperature.last_updated.strftime('%Y-%m-%dT%H:%M:%S') }} 
          {% endif %}
        device_class: timestamp
        icon_template: >-
          {% if state_attr('sensor.friggebod_temperature', 'last_updated') == None %} 
            mdi:progress-check
          {% elif (as_timestamp(now()) - as_timestamp(states.sensor.friggebod_temperature.last_updated) > 100) %}
            mdi:progress-alert
          {% else %}
            mdi:progress-check
          {% endif %}

      friggebod_fukt_lastupdated:
        friendly_name: Friggebod fukt senast uppdaterad
        value_template: >-
          {% if state_attr('sensor.friggebod_humidity', 'last_updated') == None %} 
            0 
          {% else %} 
            {{ states.sensor.friggebod_humidity.last_updated.strftime('%Y-%m-%dT%H:%M:%S') }} 
          {% endif %}
        device_class: timestamp
        icon_template: >-
          {% if state_attr('sensor.friggebod_humidity', 'last_updated') == None %} 
            mdi:progress-check
          {% elif (as_timestamp(now()) - as_timestamp(states.sensor.friggebod_humidity.last_updated) > 100) %}
            mdi:progress-alert
          {% else %}
            mdi:progress-check
          {% endif %}

      ute_friggebod_temp_lastupdated:
        friendly_name: Ute friggebod temp senast uppdaterad
        value_template: >-
          {% if state_attr('sensor.ute_friggebod_temperature', 'last_updated') == None %} 
            0 
          {% else %} 
            {{ states.sensor.ute_friggebod_temperature.last_updated.strftime('%Y-%m-%dT%H:%M:%S') }} 
          {% endif %}
        device_class: timestamp
        icon_template: >-
          {% if state_attr('sensor.ute_friggebod_temperature', 'last_updated') == None %} 
            mdi:progress-check
          {% elif (as_timestamp(now()) - as_timestamp(states.sensor.ute_friggebod_temperature.last_updated) > 100) %}
            mdi:progress-alert
          {% else %}
            mdi:progress-check
          {% endif %}

      ute_friggebod_fukt_lastupdated:
        friendly_name: Ute friggebod fukt senast uppdaterad
        value_template: >-
          {% if state_attr('sensor.ute_friggebod_humidity', 'last_updated') == None %} 
            0 
          {% else %} 
            {{ states.sensor.ute_friggebod_humidity.last_updated.strftime('%Y-%m-%dT%H:%M:%S') }} 
          {% endif %}
        device_class: timestamp
        icon_template: >-
          {% if state_attr('sensor.ute_friggebod_humidity', 'last_updated') == None %} 
            mdi:progress-check
          {% elif (as_timestamp(now()) - as_timestamp(states.sensor.ute_friggebod_humidity.last_updated) > 100) %}
            mdi:progress-alert
          {% else %}
            mdi:progress-check
          {% endif %}

      aqara_multi_sensor_3_temp_lastupdated:
        friendly_name: Aqara Multi Sensor 3 temp senast uppdaterad
        value_template: >-
          {% if state_attr('sensor.aqara_multi_sensor_3_temperature', 'last_updated') == None %} 
            0 
          {% else %} 
            {{ states.sensor.aqara_multi_sensor_3_temperature.last_updated.strftime('%Y-%m-%dT%H:%M:%S') }} 
          {% endif %}
        device_class: timestamp
        icon_template: >-
          {% if state_attr('sensor.aqara_multi_sensor_3_temperature', 'last_updated') == None %} 
            mdi:progress-check
          {% elif (as_timestamp(now()) - as_timestamp(states.sensor.aqara_multi_sensor_3_temperature.last_updated) > 100) %}
            mdi:progress-alert
          {% else %}
            mdi:progress-check
          {% endif %}

      aqara_multi_sensor_3_fukt_lastupdated:
        friendly_name: Aqara Multi Sensor 3 fukt senast uppdaterad
        value_template: >-
          {% if state_attr('sensor.aqara_multi_sensor_3_humidity', 'last_updated') == None %} 
            0 
          {% else %} 
            {{ states.sensor.aqara_multi_sensor_3_humidity.last_updated.strftime('%Y-%m-%dT%H:%M:%S') }} 
          {% endif %}
        device_class: timestamp
        icon_template: >-
          {% if state_attr('sensor.aqara_multi_sensor_3_humidity', 'last_updated') == None %} 
            mdi:progress-check
          {% elif (as_timestamp(now()) - as_timestamp(states.sensor.aqara_multi_sensor_3_humidity.last_updated) > 100) %}
            mdi:progress-alert
          {% else %}
            mdi:progress-check
          {% endif %}

      aqara_multi_sensor_4_temp_lastupdated:
        friendly_name: Aqara Multi Sensor 4 temp senast uppdaterad
        value_template: >-
          {% if state_attr('sensor.aqara_multi_sensor_4_temperature', 'last_updated') == None %} 
            0 
          {% else %} 
            {{ states.sensor.aqara_multi_sensor_4_temperature.last_updated.strftime('%Y-%m-%dT%H:%M:%S') }} 
          {% endif %}
        device_class: timestamp
        icon_template: >-
          {% if state_attr('sensor.aqara_multi_sensor_4_temperature', 'last_updated') == None %} 
            mdi:progress-check
          {% elif (as_timestamp(now()) - as_timestamp(states.sensor.aqara_multi_sensor_4_temperature.last_updated) > 100) %}
            mdi:progress-alert
          {% else %}
            mdi:progress-check
          {% endif %}

      aqara_multi_sensor_4_fukt_lastupdated:
        friendly_name: Aqara Multi Sensor 4 fukt senast uppdaterad
        value_template: >-
          {% if state_attr('sensor.aqara_multi_sensor_4_humidity', 'last_updated') == None %} 
            0 
          {% else %} 
            {{ states.sensor.aqara_multi_sensor_4_humidity.last_updated.strftime('%Y-%m-%dT%H:%M:%S') }} 
          {% endif %}
        device_class: timestamp
        icon_template: >-
          {% if state_attr('sensor.aqara_multi_sensor_4_humidity', 'last_updated') == None %} 
            mdi:progress-check
          {% elif (as_timestamp(now()) - as_timestamp(states.sensor.aqara_multi_sensor_4_humidity.last_updated) > 100) %}
            mdi:progress-alert
          {% else %}
            mdi:progress-check
          {% endif %}

#########################################################
input_boolean:
  frys_reading_missing_alarm:
    name: Frys avläsning saknas larm aktiverat
    initial: off
  kyl_reading_missing_alarm:
    name: Kyl avläsning saknas larm aktiverat
    initial: off
  badrum_reading_missing_alarm:
    name: Badrum avläsning saknas larm aktiverat
    initial: off
  tvattstuga_reading_missing_alarm:
    name: Tvättstuga avläsning saknas larm aktiverat
    initial: off
  varmepump_reading_missing_alarm:
    name: Värmepump avläsning saknas larm aktiverat
    initial: off
  vardagsrum_reading_missing_alarm:
    name: Vardagsrum avläsning saknas larm aktiverat
    initial: off
  hall_reading_missing_alarm:
    name: Hall avläsning saknas larm aktiverat
    initial: off
  forrad_reading_missing_alarm:
    name: Förråd avläsning saknas larm aktiverat
    initial: off
  garage_reading_missing_alarm:
    name: Garage avläsning saknas larm aktiverat
    initial: off
  friggebod_reading_missing_alarm:
    name: Friggebod avläsning saknas larm aktiverat
    initial: off
  ute_friggebod_reading_missing_alarm:
    name: Ute friggebod avläsning saknas larm aktiverat
    initial: off

#########################################################
automation:
  - alias: Avläsning saknas, frys
    trigger:
      - platform: time_pattern
        minutes: "/5"

    condition:
      condition: and
      conditions:
        - condition: state
          entity_id: input_boolean.frys_reading_missing_alarm
          state: 'off'
        - condition: template
          value_template: >
            {% if state_attr('sensor.frys_temperature', 'last_updated') == None %} 
              0
            {% else %} 
              {{ (as_timestamp(now())-as_timestamp(states.sensor.frys_temperature.last_updated)) > 7200 }}
            {% endif %}

    action:
      - service: homeassistant.turn_on
        entity_id: input_boolean.frys_reading_missing_alarm
#      - service: notify.pushbullet
#        data:
#          message: 'Frys - ingen avläsning på 2 timmar'
#########################################################
  - alias: Avläsning saknas, kyl
    trigger:
      - platform: time_pattern
        minutes: "/5"

    condition:
      condition: and
      conditions:
        - condition: state
          entity_id: input_boolean.kyl_reading_missing_alarm
          state: 'off'
        - condition: template
          value_template: >
            {% if state_attr('sensor.kyl_temperature', 'last_updated') == None %} 
              0
            {% else %} 
              {{ (as_timestamp(now())-as_timestamp(states.sensor.kyl_temperature.last_updated)) > 7200 }}
            {% endif %}

    action:
      - service: homeassistant.turn_on
        entity_id: input_boolean.kyl_reading_missing_alarm
#      - service: notify.pushbullet
#        data:
#          message: 'Kyl - ingen avläsning på 2 timmar'
#########################################################
  - alias: Avläsning saknas, badrum
    trigger:
      - platform: time_pattern
        minutes: "/5"

    condition:
      condition: and
      conditions:
        - condition: state
          entity_id: input_boolean.badrum_reading_missing_alarm
          state: 'off'
        - condition: or
          conditions:
            - condition: template
              value_template: >
                {% if state_attr('sensor.lumi_lumi_weather_temperature', 'last_updated') == None %} 
                  0
                {% else %} 
                  {{ (as_timestamp(now())-as_timestamp(states.sensor.lumi_lumi_weather_temperature.last_updated)) > 7200 }}
                {% endif %}
            - condition: template
              value_template: > 
                {% if state_attr('sensor.lumi_lumi_weather_humidity', 'last_updated') == None %} 
                  0
                {% else %} 
                  {{ (as_timestamp(now())-as_timestamp(states.sensor.lumi_lumi_weather_humidity.last_updated)) > 7200 }}
                {% endif %}

    action:
      - service: homeassistant.turn_on
        entity_id: input_boolean.badrum_reading_missing_alarm
#      - service: notify.pushbullet
#        data:
#          message: 'Badrum - ingen avläsning på 2 timmar'
#########################################################
  - alias: Avläsning saknas, tvättstuga
    trigger:
      - platform: time_pattern
        minutes: "/5"

    condition:
      condition: and
      conditions:
        - condition: state
          entity_id: input_boolean.tvattstuga_reading_missing_alarm
          state: 'off'
        - condition: or
          conditions:
            - condition: template
              value_template: > 
                {% if state_attr('sensor.tvattstuga_temperature', 'last_updated') == None %} 
                  0
                {% else %} 
                  {{ (as_timestamp(now())-as_timestamp(states.sensor.tvattstuga_temperature.last_updated)) > 7200 }}
                {% endif %}
            - condition: template
              value_template: > 
                {% if state_attr('sensor.tvattstuga_humidity', 'last_updated') == None %} 
                  0
                {% else %} 
                  {{ (as_timestamp(now())-as_timestamp(states.sensor.tvattstuga_humidity.last_updated)) > 7200 }}
                {% endif %}

    action:
      - service: homeassistant.turn_on
        entity_id: input_boolean.tvattstuga_reading_missing_alarm
#      - service: notify.pushbullet
#        data:
#          message: 'Badrum - ingen avläsning på 2 timmar'
#########################################################
  - alias: Avläsning saknas, värmepump
    trigger:
      - platform: time_pattern
        minutes: "/5"

    condition:
      condition: and
      conditions:
        - condition: state
          entity_id: input_boolean.varmepump_reading_missing_alarm
          state: 'off'
        - condition: template
          value_template: >
            {% if state_attr('sensor.varmepump_temperature', 'last_updated') == None %} 
              0
            {% else %} 
              {{ (as_timestamp(now())-as_timestamp(states.sensor.varmepump_temperature.last_updated)) > 7200 }}
            {% endif %}

    action:
      - service: homeassistant.turn_on
        entity_id: input_boolean.varmepump_reading_missing_alarm
#      - service: notify.pushbullet
#        data:
#          message: 'Värmepump - ingen avläsning på 2 timmar'
#########################################################
  - alias: Avläsning saknas, vardagsrum
    trigger:
      - platform: time_pattern
        minutes: "/5"

    condition:
      condition: and
      conditions:
        - condition: state
          entity_id: input_boolean.vardagsrum_reading_missing_alarm
          state: 'off'
        - condition: template
          value_template: >
            {% if state_attr('sensor.lumi_lumi_weather_temperature', 'last_updated') == None %} 
              0
            {% else %} 
              {{ (as_timestamp(now())-as_timestamp(states.sensor.lumi_lumi_weather_temperature.last_updated)) > 7200 }}
            {% endif %}

    action:
      - service: homeassistant.turn_on
        entity_id: input_boolean.vardagsrum_reading_missing_alarm
#      - service: notify.pushbullet
#        data:
#          message: 'Vardagsrum - ingen avläsning på 2 timmar'
#########################################################
  - alias: Avläsning saknas, hall
    trigger:
      - platform: time_pattern
        minutes: "/5"

    condition:
      condition: and
      conditions:
        - condition: state
          entity_id: input_boolean.hall_reading_missing_alarm
          state: 'off'
        - condition: or
          conditions:
            - condition: template
              value_template: >
                {% if state_attr('sensor.lumi_lumi_weather_temperature_2', 'last_updated') == None %} 
                  0
                {% else %} 
                  {{ (as_timestamp(now())-as_timestamp(states.sensor.lumi_lumi_weather_temperature_2.last_updated)) > 7200 }}
                {% endif %}
            - condition: template
              value_template: > 
                {% if state_attr('sensor.lumi_lumi_weather_humidity_2', 'last_updated') == None %} 
                  0
                {% else %} 
                  {{ (as_timestamp(now())-as_timestamp(states.sensor.lumi_lumi_weather_humidity_2.last_updated)) > 7200 }}
                {% endif %}

    action:
      - service: homeassistant.turn_on
        entity_id: input_boolean.hall_reading_missing_alarm
#      - service: notify.pushbullet
#        data:
#          message: 'Hall - ingen avläsning på 2 timmar'
#########################################################
  - alias: Avläsning saknas, garage
    trigger:
      - platform: time_pattern
        minutes: "/5"

    condition:
      condition: and
      conditions:
        - condition: state
          entity_id: input_boolean.garage_reading_missing_alarm
          state: 'off'
        - condition: or
          conditions:
            - condition: template
              value_template: > 
                {% if state_attr('sensor.garage_temperature', 'last_updated') == None %} 
                  0
                {% else %} 
                  {{ (as_timestamp(now())-as_timestamp(states.sensor.garage_temperature.last_updated)) > 7200 }}
                {% endif %}
            - condition: template
              value_template: > 
                {% if state_attr('sensor.garage_humidity', 'last_updated') == None %} 
                  0
                {% else %} 
                  {{ (as_timestamp(now())-as_timestamp(states.sensor.garage_humidity.last_updated)) > 7200 }}
                {% endif %}

    action:
      - service: homeassistant.turn_on
        entity_id: input_boolean.garage_reading_missing_alarm
#      - service: notify.pushbullet
#        data:
#          message: 'Garage - ingen avläsning på 2 timmar'
#########################################################
  - alias: Avläsning saknas, förråd
    trigger:
      - platform: time_pattern
        minutes: "/5"

    condition:
      condition: and
      conditions:
        - condition: state
          entity_id: input_boolean.forrad_reading_missing_alarm
          state: 'off'
        - condition: template
          value_template: >
            {% if state_attr('sensor.forrad_temperature', 'last_updated') == None %} 
              0
            {% else %} 
              {{ (as_timestamp(now())-as_timestamp(states.sensor.forrad_temperature.last_updated)) > 7200 }}
            {% endif %}

    action:
      - service: homeassistant.turn_on
        entity_id: input_boolean.forrad_reading_missing_alarm
#      - service: notify.pushbullet
#        data:
#          message: 'Förråd - ingen avläsning på 2 timmar'
#########################################################
  - alias: Avläsning saknas, friggebod
    trigger:
      - platform: time_pattern
        minutes: "/5"

    condition:
      condition: and
      conditions:
        - condition: state
          entity_id: input_boolean.friggebod_reading_missing_alarm
          state: 'off'
        - condition: or
          conditions:
            - condition: template
              value_template: > 
                {% if state_attr('sensor.friggebod_temperature', 'last_updated') == None %} 
                  0
                {% else %} 
                  {{ (as_timestamp(now())-as_timestamp(states.sensor.friggebod_temperature.last_updated)) > 7200 }}
                {% endif %}
            - condition: template
              value_template: > 
                {% if state_attr('sensor.friggebod_humidity', 'last_updated') == None %} 
                  0
                {% else %} 
                  {{ (as_timestamp(now())-as_timestamp(states.sensor.friggebod_humidity.last_updated)) > 7200 }}
                {% endif %}

    action:
      - service: homeassistant.turn_on
        entity_id: input_boolean.friggebod_reading_missing_alarm
#      - service: notify.pushbullet
#        data:
#          message: 'Friggebod - ingen avläsning på 2 timmar'
#########################################################
  - alias: Avläsning saknas, ute friggebod
    trigger:
      - platform: time_pattern
        minutes: "/5"
    condition:
      condition: and
      conditions:
        - condition: state
          entity_id: input_boolean.ute_friggebod_reading_missing_alarm
          state: 'off'
        - condition: or
          conditions:
            - condition: template
              value_template: > 
                {% if state_attr('sensor.ute_friggebod_temperature', 'last_updated') == None %} 
                  0
                {% else %} 
                  {{ (as_timestamp(now())-as_timestamp(states.sensor.ute_friggebod_temperature.last_updated)) > 7200 }}
                {% endif %}
            - condition: template
              value_template: > 
                {% if state_attr('sensor.ute_friggebod_humidity', 'last_updated') == None %} 
                  0
                {% else %} 
                  {{ (as_timestamp(now())-as_timestamp(states.sensor.ute_friggebod_humidity.last_updated)) > 7200 }}
                {% endif %}

    action:
      - service: homeassistant.turn_on
        entity_id: input_boolean.ute_friggebod_reading_missing_alarm
#      - service: notify.pushbullet
#        data:
#          message: 'Friggebod - ingen avläsning på 2 timmar'
#########################################################