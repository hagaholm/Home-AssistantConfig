##########
# Sensor #
##########
sensor:
    #####################
    # HA server metrics #
    #####################
    # https://home-assistant.io/components/sensor.systemmonitor/
  - platform: systemmonitor
    resources:
      - type: memory_free
      - type: memory_use_percent
      - type: processor_use
      - type: last_boot
      - type: disk_use_percent
        arg: /home
      - type: swap_use_percent
      - type: load_1m
      - type: load_5m
      - type: load_15m
#      - type: network_in
#        arg: ens32
#      - type: network_out
#        arg: ens32

    ##########
    # uptime #
    ##########
  - platform: uptime

    #############
    # CPU Speed #
    #############
    # https://home-assistant.io/components/sensor.cpuspeed/
  - platform: cpuspeed
    name: CPU

    #################
    # Websocket API #
    #################
    # https://www.home-assistant.io/components/websocket_api/
  - platform: websocket_api

    ######################
    # HA Current version #
    ######################
    # https://home-assistant.io/components/sensor.command_line/
  - platform: command_line
    command: python3 -c "import requests; print(requests.get('https://pypi.python.org/pypi/homeassistant/json').json()['info']['version'])"
    name: Current HA Version

    ########################
    # HA Installed version #
    ########################
  - platform: command_line
    name: Installed version
    command: "head -5 /config/.HA_VERSION"

    ##########
    # Sensor #
    ##########
#  - platform: command_line
#    name: Raspberry Pi B+ (1-Wire) Temperature
#    command: ssh pi@192.168.1.12 "cat /sys/class/thermal/thermal_zone0/temp"
#    unit_of_measurement: "°C"
#    value_template: '{{ value | multiply(0.001) | round(1) }}'

##  - platform: command_line
##    name: Raspberry Pi 3B 1 Temperature
##    command: ssh pi@192.168.1.10 "cat /sys/class/thermal/thermal_zone0/temp"
##    unit_of_measurement: "°C"
##    value_template: '{{ value | multiply(0.001) | round(1) }}'

##  - platform: command_line
##    name: Raspberry Pi 3B 2 Temperature
##    command: ssh pi@192.168.1.14 "cat /sys/class/thermal/thermal_zone0/temp"
##    unit_of_measurement: "°C"
##    value_template: '{{ value | multiply(0.001) | round(1) }}'

#  - platform: command_line
#    name: Raspberry Pi 3B Plus Temperature
#    command: ssh pi@192.168.1.15 "cat /sys/class/thermal/thermal_zone0/temp"
#    unit_of_measurement: "°C"
#    value_template: '{{ value | multiply(0.001) | round(1) }}'

    ################################
    # Internet performance metrics #
    ################################
    # https://home-assistant.io/components/sensor.speedtest/
#  - platform: speedtest
#    server_id: 2229
#    monitored_conditions:
#      - download
#      - upload
#      - ping
#    hour:
#      - 0
#      - 6
#      - 12
#      - 18

  - platform: template
    sensors:
    ###########
    # Network #
    ###########
      asus_rt_ac86u:
        friendly_name: 'Asus RT-AC86U'
        value_template: "{{ 'Online' if is_state('device_tracker.24_4b_fe_be_c1_58', 'home') else 'Offline' }}"
    
    ###############
    # Mediaplayer #
    ###############
      harmony_hub:
        friendly_name: 'Harmony Hub'
        value_template: "{{ 'Online' if is_state('device_tracker.harmonyhub', 'home') else 'Offline' }}"
      canal_digital:
        friendly_name: 'Canal Digital'
        value_template: "{{ 'Online' if is_state('device_tracker.68_63_59_44_5a_17', 'home') else 'Offline' }}"
      classic:
        friendly_name: 'SqueezeBox Classic'
        value_template: "{{ 'Online' if is_state('device_tracker.classic', 'home') else 'Offline' }}"
      yamaha:
        friendly_name: 'Yamaha RX-A1030'
        value_template: "{{ 'Online' if is_state('device_tracker.00_a0_de_a4_7c_f6', 'home') else 'Offline' }}"
      chromecast:
        friendly_name: 'Chromecast'
        value_template: "{{ 'Online' if is_state('device_tracker.chromecast', 'home') else 'Offline' }}"
      chromecast_2:
        friendly_name: 'Chromecast Wifi'
        value_template: "{{ 'Online' if is_state('device_tracker.chromecast_2', 'home') else 'Offline' }}"
      chromecast_ultra:
        friendly_name: 'Chromecast ultra'
        value_template: "{{ 'Online' if is_state('device_tracker.chromecast_ultra', 'home') else 'Offline' }}"
      samsung_tv:
        friendly_name: 'Tv Samsung'
        value_template: "{{ 'Online' if is_state('device_tracker.samsung', 'home') else 'Offline' }}"
      google_home_mini:
        friendly_name: 'Google Home Mini'
        value_template: "{{ 'Online' if is_state('device_tracker.google_home_mini', 'home') else 'Offline' }}"
      dns320:
        friendly_name: 'Nas DNS-320'
        value_template: "{{ 'Online' if is_state('device_tracker.dns320', 'home') else 'Offline' }}"
      apple_tv:
        friendly_name: 'Apple Tv'
        value_template: "{{ 'Online' if is_state('device_tracker.apple_tv', 'home') else 'Offline' }}"

    #########
    # Other #
    #########
      tradfri_gateway:
        friendly_name: 'Trådfri Gateway'
        value_template: "{{ 'Online' if is_state('device_tracker.gw_a0c9a0d8bf11', 'home') else 'Offline' }}"
      rockrobo:
        friendly_name: 'Xiaomi Roborock S5'
        value_template: "{{ 'Online' if is_state('device_tracker.rockrobo', 'home') else 'Offline' }}"
      camera1:
        friendly_name: 'Kamera 1'
        value_template: "{{ 'Online' if is_state('device_tracker.kamera1', 'home') else 'Offline' }}"
      camera2:
        friendly_name: 'Kamera 2'
        value_template: "{{ 'Online' if is_state('device_tracker.kamera2', 'home') else 'Offline' }}"
      camera3:
        friendly_name: 'Kamera 3'
        value_template: "{{ 'Online' if is_state('device_tracker.kamera3', 'home') else 'Offline' }}"
      garmin_fenix_5_plus:
        friendly_name: 'Garmin Fenix 5 Plus'
        value_template: "{{ 'Online' if is_state('device_tracker.GarminFenix5Plus', 'home') else 'Offline' }}"

    #############
    # Raspberry #
    #############
      raspberry_pi_b_plus:
        friendly_name: 'Raspberry Pi B+ (1-Wire)'
        value_template: "{{ 'Online' if is_state('device_tracker.raspberrypi', 'home') else 'Offline' }}"
      raspberry_pi_3b_1:
        friendly_name: 'Raspberry Pi 3B (Hagaholm)'
        value_template: "{{ 'Online' if is_state('device_tracker.raspberry_pi_3b_1', 'home') else 'Offline' }}"
      raspberry_pi_3b_2:
        friendly_name: 'Raspberry Pi 3B (Lux)'
        value_template: "{{ 'Online' if is_state('device_tracker.raspberrypi3b', 'home') else 'Offline' }}"
      raspberry_pi_3b_plus:
        friendly_name: 'Raspberry Pi 3B+'
        value_template: "{{ 'Online' if is_state('device_tracker.raspberry_pi_3b_plus', 'home') else 'Offline' }}"
      raspberry_pi_4b:
        friendly_name: 'Raspberry Pi 4B (Hassbian)'
        value_template: "{{ 'Online' if is_state('device_tracker.raspberry_pi_4b', 'home') else 'Offline' }}"

    ##########
    # Mobile #
    ##########
      mobil_louise:
        friendly_name: 'Louise'
        value_template: "{{ 'Online' if is_state('device_tracker.louises_a52s', 'home') else 'Offline' }}"
      mobil_annelie:
        friendly_name: 'Annelie'
        value_template: "{{ 'Online' if is_state('device_tracker.annelies_galaxy_a71', 'home') else 'Offline' }}"
      mobil_annelie_5g:
        friendly_name: 'Annelie 5G'
        value_template: "{{ 'Online' if is_state('device_tracker.mobil_annelie_5g', 'home') else 'Offline' }}"
      mobil_annelie_jobb:
        friendly_name: 'Annelie jobb'
        value_template: "{{ 'Online' if is_state('device_tracker.6a_39_76_15_04_d9', 'home') else 'Offline' }}"
      mobil_micke:
        friendly_name: 'Micke'
        value_template: "{{ 'Online' if is_state('device_tracker.galaxy_a52s_5g', 'home') else 'Offline' }}" # Mickes mobil
      mobil_andreas:
        friendly_name: 'Andreas'
        value_template: "{{ 'Online' if is_state('device_tracker.iphone', 'home') else 'Offline' }}"
      mobil_margareta:
        friendly_name: 'Margareta'
        value_template: "{{ 'Online' if is_state('device_tracker.mobil_margareta', 'home') else 'Offline' }}"
      mobil_herbert:
        friendly_name: 'Herbert'
        value_template: "{{ 'Online' if is_state('device_tracker.mobil_herbert', 'home') else 'Offline' }}"
      mobil_erik:
        friendly_name: 'Erik'
        value_template: "{{ 'Online' if is_state('device_tracker.mobil_erik', 'home') else 'Offline' }}"

      ##########
      # Laptop #
      ##########
      mickes_laptop:
        friendly_name: 'Mickes dator'
        value_template: "{{ 'Online' if is_state('device_tracker.laptop_664qq6s0', 'home') else 'Offline' }}"
      mickes_work_laptop:
        friendly_name: 'Mickes jobb dator'
        value_template: "{{ 'Online' if is_state('device_tracker.seeskwjcpc8g3', 'home') or is_state('device_tracker.seeskwjcpc8g3_2', 'home') else 'Offline' }}"
      louise_dator:
        friendly_name: 'Louise dator'
        value_template: "{{ 'Online' if is_state('device_tracker.louise_dator', 'home') else 'Offline' }}"
      herberts_dator:
        friendly_name: 'Herberts dator'
        value_template: "{{ 'Online' if is_state('device_tracker.herberts_dator', 'home') else 'Offline' }}"

##############
# Automation #
##############
automation:
    ################################
    ### Hassbian startad         ###
    ### T: homeassistant = start ###
    ### A: notify.pushbullet     ###
    ################################
  - alias: 'Hassbian startad'
    trigger:
      platform: homeassistant
      event: start
    action:
      - service: notify.pushbullet
        data:
          title: "Hassbian startad!"
          message: ""

    ###################################
    ### Hassbian stoppad            ###
    ### T: homeassistant = shutdown ###
    ### A: notify.pushbullet        ###
    ###################################
  - alias: 'Hassbian stoppad'
    trigger:
      platform: homeassistant
      event: shutdown
    action:
      - service: notify.pushbullet
        data:
          title: "Hassbian stoppad!"
          message: ""

    ###############################
    ### Hassbian uppdatering    ###
    ### T:binary_sensor.updater ###
    ### A: notify.pushbullet    ###
    ###############################
  - alias: Hassbian uppdatering
    trigger:
      - platform: state
        entity_id: binary_sensor.updater
        from: 'off'
        to: 'on'
    action:
      - service: notify.pushbullet
        data: 
          title: 'Ny Home Assistant Release'
          message: "Home Assistant {{ sensor.installed_version }} --> {{ sensor.current_ha_version }}"

    ####################################
    ### Ny enhet hittad              ###
    ### T: device_tracker_new_device ###
    ### A: notify.pushbullet         ###
    ####################################
  - alias: Ny enhet hittad
    trigger:
      platform: event
      event_type: device_tracker_new_device
    action:
      - service: notify.pushbullet
        data:
          title: "Ny enhet hittad"
          message: "Enhet: {{trigger.event.data.host_name}} ({{trigger.event.data.entity_id}})"
